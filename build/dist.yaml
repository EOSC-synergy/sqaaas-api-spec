openapi: 3.0.0
info:
  title: SQAaaS API
  description: >-
    OpenAPI specification for the Software and Service Quality Assurance as a
    Service (SQAaaS) component.
  license:
    name: GPLv3
    url: 'https://www.gnu.org/licenses/gpl-3.0.txt'
  version: 2.6.0
servers:
  - url: 'http://api.sqaaas.eosc-synergy.eu/v1'
    description: Main (production) API server
  - url: 'https://api-staging.sqaaas.eosc-synergy.eu'
    description: Staging API server for testing
  - url: 'https://api-dev.sqaaas.eosc-synergy.eu'
    description: Development API server (mock server)
paths:
  /criteria:
    get:
      operationId: get_criteria
      summary: Returns data about criteria
      parameters:
        - in: query
          name: criterion_id
          description: Get data from a specific criterion
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Criterion'
        '400':
          description: Invalid criterion supplied
        '404':
          description: Criterion not found
  /pipeline:
    post:
      operationId: add_pipeline
      summary: Creates a pipeline.
      description: >
        Provides a ready-to-use Jenkins pipeline based on the v2 series of
        jenkins-pipeline-library.
      parameters:
        - in: query
          name: report_to_stdout
          description: >-
            Flag to indicate whether the pipeline shall print via via stdout the
            reports produced by the tools (required by QAA module)
          required: false
          schema:
            type: boolean
            default: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Pipeline'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: UUID identifying the pipeline
              example:
                id: dd7d8481-81a3-407f-95f0-a2f1cb382a4b
          links:
            get_pipeline_by_pipeline_id:
              operationId: get_pipeline_by_id
              parameters:
                pipeline_id: $response.body#/id
              description: >
                The `id` value returned in the response can be used as the
                `pipeline_id` parameter in `GET /pipeline/{pipeline_id}`.
        '400':
          description: Request failed validation
    get:
      operationId: get_pipelines
      summary: Gets pipeline IDs.
      description: |
        Returns the list of IDs for the defined pipelines.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Pipeline'
  /pipeline/assessment:
    post:
      operationId: add_pipeline_for_assessment
      summary: Creates a pipeline for assessment (QAA module).
      description: |
        Creates a pipeline for assessment (QAA module).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Pipeline_assessment'
      parameters:
        - in: query
          name: optional_tools
          description: Optional tools that shall be accounted
          required: false
          schema:
            type: array
            items:
              type: string
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: UUID identifying the pipeline
              example:
                id: dd7d8481-81a3-407f-95f0-a2f1cb382a4b
          links:
            get_pipeline_by_pipeline_id:
              operationId: get_pipeline_by_id
              parameters:
                pipeline_id: $response.body#/id
              description: >
                The `id` value returned in the response can be used as the
                `pipeline_id` parameter in `GET /pipeline/{pipeline_id}`.
        '400':
          description: Request failed validation
  '/pipeline/assessment/{pipeline_id}/output':
    get:
      operationId: get_output_for_assessment
      summary: Get the assessment output (QAA module)
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
      description: >
        Returns the reporting and badging data from the execution of the
        assessment pipeline.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                $ref: '#/components/schemas/AssessmentOutput'
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
        '422':
          description: Pipeline has not been executed
  '/pipeline/{pipeline_id}':
    get:
      operationId: get_pipeline_by_id
      summary: Find pipeline by ID
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Pipeline'
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
    put:
      operationId: update_pipeline_by_id
      summary: Update pipeline by ID
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
        - in: query
          name: report_to_stdout
          description: >-
            Flag to indicate whether the pipeline shall print via via stdout the
            reports produced by the tools (required by QAA module)
          required: false
          schema:
            type: boolean
            default: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Pipeline'
      responses:
        '204':
          description: Pipeline successfully updated
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
        '502':
          $ref: '#/components/responses/BadGateway'
    delete:
      operationId: delete_pipeline_by_id
      summary: Delete pipeline by ID
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Pipeline successfully deleted
        '400':
          description: Request failed validation
        '404':
          description: Pipeline not found
        '502':
          $ref: '#/components/responses/BadGateway'
  '/pipeline/{pipeline_id}/config':
    get:
      operationId: get_pipeline_config
      summary: Gets pipeline's main configuration.
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
      description: |
        Returns the content of JePL's config.yml file.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/JePL_config'
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
  '/pipeline/{pipeline_id}/config/jepl':
    get:
      operationId: get_pipeline_config_jepl
      summary: Gets JePL config configuration for the given pipeline.
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
      description: |
        Returns the content of JePL's config file.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    file_name:
                      type: string
                      example:
                        file_name: config.yml
                    content:
                      type: object
                      $ref: '#/components/schemas/CriterionBuild'
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
  '/pipeline/{pipeline_id}/config/scripts':
    get:
      operationId: get_pipeline_commands_scripts
      summary: Gets the commands builder scripts
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
      description: >
        Returns the content of the list of scripts generated for the commands
        builder.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    file_name:
                      type: string
                      example: script.sh
                    content:
                      type: string
                      example: |-
                        (
                        cd workdir ; npm install
                        )
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
  '/pipeline/{pipeline_id}/composer':
    get:
      operationId: get_pipeline_composer
      summary: Gets composer configuration used by the pipeline.
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
      description: |
        Returns the content of JePL's docker-compose.yml file.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/JePL_composer'
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
  '/pipeline/{pipeline_id}/composer/jepl':
    get:
      operationId: get_pipeline_composer_jepl
      summary: Gets JePL composer configuration for the given pipeline.
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
      description: |
        Returns the content of JePL's composer file.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  file_name:
                    type: string
                    example:
                      file_name: docker-compose.yml
                  content:
                    type: object
                    $ref: '#/components/schemas/JePL_composer'
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
  '/pipeline/{pipeline_id}/jenkinsfile':
    get:
      operationId: get_pipeline_jenkinsfile
      summary: Gets Jenkins pipeline definition used by the pipeline.
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
      description: |
        Returns the content of JePL's Jenkinsfile file.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/JePL_jenkinsfile'
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
  '/pipeline/{pipeline_id}/jenkinsfile/jepl':
    get:
      operationId: get_pipeline_jenkinsfile_jepl
      summary: Gets Jenkins configuration for the given pipeline.
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
      description: |
        Returns the content of Jenkinsfile file for the given pipeline.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  file_name:
                    type: string
                    example:
                      file_name: Jenkinsfile
                  content:
                    type: string
                example:
                  file_name: Jenkinsfile
                  content: >-
                    @Library(['github.com/indigo-dc/jenkins-pipeline-library@release/2.1.0'])
                    _


                    def projectConfig


                    pipeline {
                        agent any

                        stages {
                            stage('SQA baseline criterion: QC.Sty') {
                                when {
                                    branch pattern: 'sqaaas', comparator: ''
                                }
                                steps {
                                    script {
                                        projectConfig = pipelineConfig(
                                            configFile: '.sqa/config.yml',
                                            scmConfigs: [ localBranch: true ]
                                        )
                                        buildStages(projectConfig)
                                    }
                                }
                                post {
                                    cleanup {
                                        cleanWs()
                                    }
                                }
                            }
                            stage('SQA baseline criterion: QC.Doc') {
                                when {
                                    branch pattern: 'build', comparator: ''
                                }
                                steps {
                                    script {
                                        projectConfig = pipelineConfig(
                                            configFile: '.sqa/config.snappy-peach-chicken.yml',
                                            scmConfigs: [ localBranch: true ]
                                        )
                                        buildStages(projectConfig)
                                    }
                                }
                                post {
                                    cleanup {
                                        cleanWs()
                                    }
                                }
                            }
                        }
                    }
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
  '/pipeline/{pipeline_id}/run':
    post:
      operationId: run_pipeline
      summary: Runs pipeline.
      description: |
        Executes the given pipeline by means of the Jenkins API.
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
        - in: query
          name: issue_badge
          description: >-
            Flag to indicate whether a badge shall be issued if the pipeline
            succeds
          required: false
          schema:
            type: boolean
            default: false
        - in: query
          name: repo_url
          description: URL of the upstream repository to fetch the code from
          required: false
          schema:
            type: string
            format: uri
        - in: query
          name: repo_branch
          description: Branch name of the upstream repository to fetch the code from
          required: false
          schema:
            type: string
        - in: query
          name: keepgoing
          description: Flag to indicate that the pipeline will run until the end
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '204':
          description: Successful operation
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
        '502':
          $ref: '#/components/responses/BadGateway'
  '/pipeline/{pipeline_id}/status':
    get:
      operationId: get_pipeline_status
      summary: Get pipeline status.
      description: |
        Obtains the build URL in Jenkins for the given pipeline.
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  build_url:
                    type: string
                    format: uri
                  build_status:
                    type: string
                    enum:
                      - success
                      - failure
                      - aborted
                      - not_built
                      - unstable
                      - waiting_scan_org
                  openbadge_id:
                    type: string
                    format: uri
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
        '422':
          description: Pipeline has not been executed
        '502':
          $ref: '#/components/responses/BadGateway'
  '/pipeline/{pipeline_id}/pull_request':
    post:
      operationId: create_pull_request
      summary: Creates pull request with JePL files.
      description: |
        Create a pull request with the generated JePL files.
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                repo:
                  type: string
                  format: uri
                  description: URL of the upstream repo
                branch:
                  type: string
                  description: >-
                    Brach from the upstream repo used as the base for the pull
                    request
              required:
                - repo
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  pull_request_url:
                    type: string
                    format: uri
              example:
                pull_request_url: 'https://github.com/eosc-synergy/sqaaas-api-spec/pull/23'
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
        '502':
          $ref: '#/components/responses/BadGateway'
  '/pipeline/{pipeline_id}/compressed_files':
    get:
      operationId: get_compressed_files
      summary: Get JePL files in compressed format.
      description: |
        Obtains the generated JePL files in compressed format.
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
      responses:
        '200':
          description: ZIP fle with JePL files
          content:
            application/zip:
              schema:
                type: string
                format: binary
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
  '/pipeline/{pipeline_id}/badge':
    get:
      operationId: get_badge
      summary: Gets badge data associated with the given pipeline
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
      description: |
        Returns the badge data associated with the pipeline.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Badge'
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
        '422':
          description: Badge not issued
  '/pipeline/{pipeline_id}/output':
    get:
      operationId: get_pipeline_output
      summary: Get output from pipeline execution
      parameters:
        - in: path
          name: pipeline_id
          description: ID of the pipeline to get
          required: true
          schema:
            type: string
        - in: query
          name: validate
          description: >-
            Flag to indicate whether the returned output shall be validate using
            sqaaas-reporting tool
          required: false
          schema:
            type: boolean
            default: false
      description: |
        Returns the console output from the pipeline execution.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                $ref: '#/components/schemas/CriterionOutput'
        '400':
          description: Invalid pipeline ID supplied
        '404':
          description: Pipeline not found
        '422':
          description: Pipeline has not been executed
components:
  schemas:
    ToolArg:
      type: object
      properties:
        type:
          type: string
          enum:
            - subcommand
            - positional
            - optional
          description: type of argument
        description:
          type: string
          description: hint about what the command does
          example: Detect the license of the given project
        value:
          description: Value for the argument (can be of any type)
          example: detect
        option:
          type: string
          description: 'Name of the option, in the event of optional arguments'
        summary:
          type: string
          description: very brief (2/3 words) description (to be rendered by web clients)
        format:
          type: string
          enum:
            - string
            - array
          description: The value format (to be rendered by web clients)
        selectable:
          type: boolean
          description: >-
            Whether the argument can be selected by the user (to be rendered by
            web clients)
          default: true
        repeatable:
          type: boolean
          description: Whether the argument can be repeated (to be rendered by web clients)
          default: false
        args:
          type: array
          items:
            $ref: '#/components/schemas/ToolArg'
      required:
        - type
        - description
    Tool:
      type: object
      description: >-
        Details about the tooling metadata (see
        https://github.com/eosc-synergy/sqaaas-tooling)
      properties:
        name:
          type: string
          description: Name of the tool
          example: flake8
        lang:
          type: string
          description: Language that the tool is aligned with
          example: Python
        version:
          type: string
          description: Version of the tool
          example: 4.0.1
        jepl_support:
          type: boolean
        docs:
          type: string
          format: uri
        docker:
          type: object
          properties:
            image:
              type: string
            dockerfile:
              type: string
            reviewed:
              type: string
              format: date
            oneshot:
              type: boolean
              default: true
        executable:
          type: string
        args:
          type: array
          items:
            $ref: '#/components/schemas/ToolArg'
      required:
        - name
        - lang
        - docs
        - docker
    Criterion:
      type: object
      properties:
        id:
          type: string
          description: ID of the criterion
          example: QC.Sty
        type:
          type: string
          description: Type of criterion
          enum:
            - software
            - service
            - fair
        description:
          type: object
          description: Details about the criterion
          properties:
            msg:
              type: string
              description: Short statemente about the criterion's goal
            improves:
              type: string
              description: >-
                Comma-separated list of software/service characteristics
                addressed by the given criterion
            docs:
              type: string
              description: URL with additional information about the criterion
              format: uri
        tools:
          type: array
          description: Set of tools that are supported for the given criterion
          items:
            $ref: '#/components/schemas/Tool'
    Repository:
      type: object
      properties:
        repo:
          type: string
          description: URL of the repository
          format: uri
          example: 'https://github.com/eosc-synergy/sqaaas-api-spec'
        branch:
          type: string
          description: Branch name
          example: master
    Creds_user_pass:
      type: object
      properties:
        id:
          type: string
          description: Credential ID (as defined in Jenkins)
          example: my-dockerhub-token
        type:
          type: string
          description: Credential type
          enum:
            - username_password
        username_var:
          type: string
          example: GIT_USER
        password_var:
          type: string
          example: GIT_PASS
      required:
        - id
        - username_var
        - password_var
    Commands_simplified:
      type: array
      description: List of commands to execute
      items:
        type: string
        minLength: 1
      example:
        - 'mvn checkstyle:check'
    Tox_simplified:
      type: object
      description: Details about Python's tox configuration
      properties:
        testenv:
          type: array
          items:
            type: string
            minLength: 1
          default:
            - ALL
          example:
            - cover
        tox_file:
          type: string
          default: tox.ini
          example: tox.ini
    When_branch:
      type: object
      properties:
        pattern:
          type: string
          minLength: 1
          example: release-\\d+
        comparator:
          type: string
          enum:
            - EQUALS
            - GLOB
            - REGEXP
          default: GLOB
      required:
        - pattern
    When_building_tag:
      type: boolean
    CriterionBuild:
      type: object
      description: Definition of software and service criteria to be run by the pipeline
      additionalProperties:
        type: object
        description: ID of the criterion
        minProperties: 1
        properties:
          repos:
            type: array
            description: >-
              List of repositories (from config:project_repos) for which the
              given criterion will be checked
            items:
              type: object
              properties:
                repo_url:
                  type: string
                  description: URL of the repository
                  format: uri
                  example: 'https://github.com/eosc-synergy/sqaaas-api-spec'
                container:
                  type: string
                  description: >-
                    Container name as defined in the JePL composer's file (i.e.
                    docker-compose.yml)
                  example: testing
                commands:
                  $ref: '#/components/schemas/Commands_simplified'
                tox:
                  $ref: '#/components/schemas/Tox_simplified'
                tool:
                  $ref: '#/components/schemas/Tool'
              additionalProperties: false
          when:
            type: object
            description: >-
              Requirements that should take into account to execute the
              pipeline, such as branch/tags names
            properties:
              branch:
                $ref: '#/components/schemas/When_branch'
              building_tag:
                $ref: '#/components/schemas/When_building_tag'
            additionalProperties: false
        required:
          - repos
    Environment:
      type: object
      description: Environment variables to be used at pipeline runtime
      additionalProperties:
        type: string
      example:
        JPL_IGNOREFAILURES: defined
        JPL_DOCKERPUSH: docs service1 service4
    JePL_config:
      type: object
      description: Properties for a single JePL's config.yml file
      properties:
        config:
          type: object
          description: JePL's main configuration
          properties:
            project_repos:
              type: array
              description: >-
                Set of repositories to be fetched by the pipeline (may exclude
                the repository where the pipeline is stored)
              items:
                $ref: '#/components/schemas/Repository'
            credentials:
              type: array
              description: >-
                List of credentials required to access successfuly to the
                resources (such as repositories) managed by the pipeline
              items:
                $ref: '#/components/schemas/Creds_user_pass'
        sqa_criteria:
          type: object
          $ref: '#/components/schemas/CriterionBuild'
        environment:
          $ref: '#/components/schemas/Environment'
        timeout:
          type: integer
          description: Maximum timeframe for the pipeline execution
          minimum: 1
    ServiceDockerCompose:
      type: object
      additionalProperties:
        type: object
        properties:
          build:
            type: object
            properties:
              context:
                type: string
                example: ./dir
              dockerfile:
                type: string
                example: Dockerfile-alternate
              args:
                type: object
                additionalProperties:
                  type: string
          image:
            type: object
            properties:
              name:
                type: string
                example: 'eoscsynergy/sqaaas-api-spec:1.0.0'
              registry:
                type: object
                properties:
                  push:
                    type: boolean
                  credential_id:
                    type: string
                    example: my-dockerhub-cred
            required:
              - name
          hostname:
            type: string
            example: sqaaas-host
          volumes:
            type: array
            items:
              type: object
              properties:
                type:
                  type: string
                  enum:
                    - bind
                source:
                  type: string
                  example: ./
                target:
                  type: string
                  example: ./sqaaas-build
          command:
            type: string
            example: sleep 600000
          environment:
            $ref: '#/components/schemas/Environment'
          oneshot:
            type: boolean
            default: true
    JePL_composer:
      type: object
      description: >-
        Details about the composition of the services required for the pipeline
        execution
      properties:
        version:
          type: string
          example: '3.7'
        services:
          type: object
          $ref: '#/components/schemas/ServiceDockerCompose'
    JePL_jenkinsfile:
      type: object
      description: Details about the Jenkins Pipeline as Code
      properties:
        stages:
          type: array
          items:
            type: object
            properties:
              when:
                type: object
                properties:
                  branches:
                    type: array
                    items:
                      type: string
                      example: master
              pipeline_config:
                type: object
                properties:
                  config_file:
                    type: string
                    example: ./.sqa/config.yml
                  base_repository:
                    type: string
                    example: master
                  base_branch:
                    type: string
                    example: 'https://github.com/eosc-synergy/sqaaas-api-spec'
                  credentials_id:
                    type: string
                    example: userpass_dockerhub
                  jepl_validator_docker_image:
                    type: string
                    example: 'eoscsynergy/jpl-validator:1.1.0'
    Pipeline:
      type: object
      properties:
        id:
          type: string
          description: ID of the criterion
          readOnly: true
          example: dd7d8481-81a3-407f-95f0-a2f1cb382a4b
        name:
          type: string
          description: Name that identifies the pipeline
          format: '[A-Za-z0-9_.-]'
          example: sqaaas-api-spec
        config_data:
          type: array
          description: Details about the pipeline configuration
          items:
            $ref: '#/components/schemas/JePL_config'
        composer_data:
          $ref: '#/components/schemas/JePL_composer'
        jenkinsfile_data:
          $ref: '#/components/schemas/JePL_jenkinsfile'
    AssessmentDeployment:
      type: object
      properties:
        repo_deploy:
          $ref: '#/components/schemas/Repository'
        deploy_tool:
          $ref: '#/components/schemas/Tool'
    AssessmentFAIR:
      type: object
      properties:
        persistent_identifier:
          type: string
          description: Persistent identifier for the dataset
          example: 'https://doi.org/10.5281/zenodo.5993188'
        metadata_protocol:
          type: string
          description: Protocol for metadata harvesting
          example: oai-pmh
        metadata_endpoint:
          type: string
          format: uri
          description: URL of the metadata protocol interface
          example: 'http://digital.csic.es/dspace-oai/request'
        evaluator_tool:
          type: string
          description: Name of the evaluator tool
          example: fair-eva
        evaluator_endpoint:
          type: string
          format: uri
          description: URL of the endpoint where the evaluator is accessible
          example: 'http://localhost:9090/v1.0/rda/rda_all'
        badge_policy_url:
          type: string
          format: uri
          description: URL where the badge policies are defined
          example: 'https://example.org/badge-matchmaking-policies.ini'
    Pipeline_assessment:
      type: object
      properties:
        repo_code:
          $ref: '#/components/schemas/Repository'
        repo_docs:
          $ref: '#/components/schemas/Repository'
        deployment:
          $ref: '#/components/schemas/AssessmentDeployment'
        fair:
          $ref: '#/components/schemas/AssessmentFAIR'
      required:
        - repo_code
    AssessmentOutputRepository:
      type: object
      properties:
        name:
          description: (nick) Name of the repository
          type: string
          example: sqaaas-api-spec
        url:
          description: URL of the repository
          type: string
          format: uri
          example: 'https://github.com/eosc-synergy/sqaaas-api-spec'
        avatar_url:
          description: Avatar URL for the repository
          type: string
          format: uri
          example: 'https://avatars.githubusercontent.com/u/57723286?v=4'
        description:
          description: One-liner containing the repository's purpose
          type: string
          example: OpenAPI specification for the SQA as a Service
        languages:
          description: Programming language used
          type: array
          items:
            type: string
            example: Shell
        tag:
          description: Git tag that corresponds to the current version
          type: string
          example: 2.5.0
        topics:
          description: Labels that characterize the repository
          type: array
          items:
            type: string
          example:
            - openapi
            - sqaaas
        stargazers_count:
          description: (GitHub only) Number of stars
          type: number
          example: 2
        watchers_count:
          description: (GitHub only) Number of watchers
          type: number
          example: 2
        contributors_count:
          description: (GitHub only) Number of contributors
          type: number
          example: 2
        forks_count:
          description: (GitHub only) Number of forks
          type: number
          example: 2
    AssessmentOutputToolCI:
      type: object
      description: Details of the CI build where the tool was executed
      properties:
        name:
          type: string
          description: Name of the stage the tool was executed
        status:
          type: string
          description: Exit status of the stage where the tool ran
          enum:
            - SUCCESS
            - FAILURE
        stdout_command:
          type: array
          description: List of commands executed in the stage
          items:
            type: string
        stdout_text:
          description: Output of the tool execution
          type: string
        url:
          type: string
          description: URL of the build's stage output
          format: uri
    AssessmentOutputValidatorTool:
      type: object
      description: Details about the tool
      properties:
        name:
          type: string
          description: Name of the tool
          example: flake8
        lang:
          type: string
          description: Language that the tool is aligned with
          example: Python
        version:
          type: string
          description: Version of the tool
          example: 4.0.1
        docker:
          type: object
          properties:
            image:
              type: string
            dockerfile:
              type: string
            reviewed:
              type: string
              format: date
            oneshot:
              type: boolean
              default: true
        ci:
          $ref: '#/components/schemas/AssessmentOutputToolCI'
        build_repo:
          type: string
          format: uri
          example: 'https://github.com/EOSC-synergy/saps-catalog.assess.sqaaas'
        level:
          type: string
          description: Level of criticality of the tool
          enum:
            - REQUIRED
            - RECOMMENDED
            - OPTIONAL
    AssessmentOutputValidatorStandard:
      type: object
      description: Details about the quality standard that defines the given subcriterion
      properties:
        title:
          type: string
          description: Standard title
          example: >-
            A set of Common Software Quality Assurance Baseline Criteria for
            Research Projects
        version:
          type: string
          description: Standard version
          example: v4.0
        url:
          type: string
          description: URL containing the standard's specification
          format: uri
          example: 'https://indigo-dc.github.io/sqa-baseline/'
    AssessmentOutputValidator:
      type: object
      properties:
        valid:
          type: boolean
          description: Validity of the subcriterion according to the tool
        message:
          type: string
          description: Short statement about the evidence found
          example: README file does not exist
        plugin:
          type: object
          description: Details about the tool's validator plugin being executed
          properties:
            name:
              description: Name of the plugin
              type: string
              example: report2sqaaas-plugin-licensee
            version:
              description: Version of the plugin
              type: string
              example: 1.0.0
        tool:
          $ref: '#/components/schemas/AssessmentOutputValidatorTool'
        standard:
          $ref: '#/components/schemas/AssessmentOutputValidatorStandard'
        data_unstructured:
          type: object
          description: Any unstructured data provided by the tool
    AssessmentOutputSubcriteria:
      type: object
      description: ID of the subcriterion
      properties:
        description:
          type: string
          description: Short statement about the goal of the given subcriterion
          example: All code repositories MUST have a README file
        valid:
          type: boolean
          description: Overall validity of the subcriterion
        evidence:
          type: array
          description: Evidence obtained by the tools for the given subcriterion
          items:
            $ref: '#/components/schemas/AssessmentOutputValidator'
        hint:
          type: string
          description: Provide hints to fulfill the current subcriterion
          example: >
            The Open Source Initiative (OSI) sets out the requirements for
            software to be legally declared as open source. Use one of the <a
            href="https://opensource.org/licenses">OSI popular licenses</a> for
            this check to be successful.
        required_for_next_level_badge:
          type: boolean
          description: >-
            Whether current subcriterion is required for the next level of
            badging
    BadgeCriteriaStats:
      type: object
      description: Identifier of the badge class (e.g. bronze)
      properties:
        to_fulfill:
          description: List of criteria codes to be fulfilled for the given badge class
          type: array
          default: []
          items:
            type: string
            default: null
            example: criterion_id
        missing:
          description: List of missing criteria codes for the badge class to be granted
          type: array
          default: []
          items:
            type: string
            default: null
        fulfilled:
          description: List of fulfilled criteria codes for the given badge class
          type: array
          default: []
          items:
            type: string
            default: null
    BadgeAssertion:
      type: object
      description: Badge data as obtained from Open Badge's Badgr implementation
      properties:
        openBadgeID:
          type: string
          format: uri
          example: 'https://api.eu.badgr.io/public/assertions/KSwijifTQ_-I1lb9FtX1bw'
        createdAt:
          type: string
          format: date-time
          example: 2021-04-07T10:34:02.960Z
        createdBy:
          type: string
          example: e3h49VVbQRKQphuAAmxpgQ
        badgeClass:
          type: string
          example: sBS3EsJQRAC0ENTmvETtQw
        issuer:
          type: string
          example: aS1lWKgIR4u8bGjPZUzAyg
        image:
          type: string
          format: uri
          example: >-
            https://api.eu.badgr.io/public/assertions/KSwijifTQ_-I1lb9FtX1bw/image
        recipient:
          type: object
          properties:
            identity:
              type: string
              example: >-
                sha256$5cb2939f3ae83961b31407fbfd2978e5c642177e50227eb0c7f550c0653803dc
            hashed:
              type: boolean
            type:
              type: string
              enum:
                - email
                - openBadgeId
                - telephone
                - url
            plaintextIdentity:
              type: string
              example: >-
                https://github.com/EOSC-synergy/test-sqaaas-web.sqaaas/commit/41a4a73505f407d57e7ed600dd5de7cf963feda3
        issuedOn:
          type: string
          format: date-time
          example: 2021-04-07T10:07:00.000Z
    Badge:
      type: object
      properties:
        criteria:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/BadgeCriteriaStats'
        data:
          $ref: '#/components/schemas/BadgeAssertion'
        share:
          type: string
          description: Badge's HTML block that can be embedded in websites
          example: <html>..</html>
        verification_url:
          type: string
          description: URL the portal where the badge can be verified
          format: uri
    AssessmentOutput:
      type: object
      properties:
        repository:
          type: array
          items:
            $ref: '#/components/schemas/AssessmentOutputRepository'
        report:
          type: object
          additionalProperties:
            description: ID of the criterion
            type: object
            properties:
              valid:
                description: Overall validity of the criterion
                type: boolean
                default: false
              filtered_reason:
                description: >-
                  Contains the reason why the criterion was filtered out (if
                  applicable)
                type: array
                default: []
                items:
                  type: string
                  default: null
              subcriteria:
                type: object
                additionalProperties:
                  $ref: '#/components/schemas/AssessmentOutputSubcriteria'
              coverage:
                type: object
                properties:
                  percentage:
                    description: Overall percentage of criterion coverage
                    type: number
                    example: 60
                  total_subcriteria:
                    description: Number of total subcriteria assessed for the criterion
                    type: integer
                    example: 5
                  success_subcriteria:
                    description: Number of subcriteria evaluates as success
                    type: integer
                    example: 0
        badge:
          type: object
          properties:
            software:
              $ref: '#/components/schemas/Badge'
            services:
              $ref: '#/components/schemas/Badge'
            fair:
              $ref: '#/components/schemas/Badge'
    UpstreamError:
      type: object
      properties:
        upstream_status:
          type: integer
        upstream_reason:
          type: string
      required:
        - upstream_status
        - upstream_reason
    CriterionOutput:
      type: object
      additionalProperties:
        type: array
        items:
          type: object
          properties:
            status:
              type: string
              enum:
                - SUCCESS
                - FAILED
            stdout_command:
              type: string
            stdout_text:
              type: string
            tool:
              type: string
            validator:
              type: string
            validation:
              type: object
              properties:
                valid:
                  type: boolean
                data_unstructured:
                  type: object
      example:
        QC.Lic:
          - status: SUCCESS
            stdout_command: >-
              + docker-compose -f .sqa/docker-compose.yml --project-directory
              /jenkins/workspace/ava-maven-app.assess.sqaaas_main/ exec -T
              qc.lic_boozy-smalt-maltese /usr/bin/env sh
              .sqa/script.paltry-taupe-reindeer.sh
            tool: licensee
            validator: licensee
            validation:
              valid: true
              data_unstructured: {}
  responses:
    BadGateway:
      description: |
        The server while acting as a gateway or a proxy, received
        an invalid response from the upstream server it accessed
        in attempting to fulfill the request.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/UpstreamError'
